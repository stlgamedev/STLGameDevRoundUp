{{/* Find the latest issue page */}}
{{ $latestIssue := "" }}
{{ $latestNo := 0 }}
{{ range where .Site.RegularPages "Section" "" }}
  {{ if .Params.no }}
    {{ if and (not .Params.is_test) (gt .Params.no $latestNo) }}
      {{ $latestNo = .Params.no }}
      {{ $latestIssue = . }}
    {{ end }}
  {{ end }}
{{ end }}

{{ if $latestIssue }}
{{/* Get the email output format of the latest issue */}}
{{ $emailOutput := $latestIssue.OutputFormats.Get "email" }}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="refresh" content="0; url={{ $emailOutput.RelPermalink }}">
  <link rel="canonical" href="{{ $emailOutput.Permalink }}">
  <title>Redirecting to Latest Issue Email...</title>
  <script>
    window.location.href = "{{ $emailOutput.RelPermalink }}";
  </script>
</head>
<body>
  <p>Redirecting to <a href="{{ $emailOutput.RelPermalink }}">Issue #{{ $latestIssue.Params.no }} Email</a>...</p>
  <p>If you are not redirected, <a href="{{ $emailOutput.RelPermalink }}">click here</a>.</p>
</body>
</html>
{{ else }}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>No Issues Found</title>
</head>
<body>
  <h1>No Issues Found</h1>
  <p>There are no published issues yet.</p>
</body>
</html>
{{ end }}
